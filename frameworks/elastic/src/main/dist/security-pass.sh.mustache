#!/usr/bin/env bash

{{#SECURITY_ENABLED}}
ELASTIC_USER={{ELASTICSEARCH_HEALTH_USER}}
ELASTIC_PASS={{ELASTICSEARCH_HEALTH_USER_PASSWORD}}
PROTOCOL={{ELASTICSEARCH_HTTP_PROTOCOL}}
VERSION={{ELASTIC_VERSION}}

printf ${ELASTIC_PASS} | ./elasticsearch-${VERSION}/bin/elasticsearch-keystore add -f -x "bootstrap.password"
curl -u ${ELASTIC_USER}:${ELASTIC_PASS} -XPUT -H 'Content-Type: application/json' '${PROTOCOL}://${TASK_NAME}.${FRAMEWORK_HOST}:${PORT_HTTP}/_xpack/security/user/kibana/_password 75' -d '{ "password":"${ELASTIC_PASS}" }'
curl -u ${ELASTIC_USER}:${ELASTIC_PASS} -XPUT -H 'Content-Type: application/json' '${PROTOCOL}://${TASK_NAME}.${FRAMEWORK_HOST}:${PORT_HTTP}/_xpack/security/user/elastic/_password 75' -d '{ "password":"${ELASTIC_PASS}" }'
{{/SECURITY_ENABLED}}